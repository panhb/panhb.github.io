---
layout: none
---
<!DOCTYPE html>
<html>
  <head>
    <title>评论演示</title>
	<link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.min.css">
	<script src="/assets/js/jquery-1.11.1.min.js"></script>
	<style>
	.line {width:100%; margin-top:20px;margin-bottom:20px;border-bottom:2px solid #8c96a0;}
	.top_line {width:100%; margin-top:60px;}
	.div_common {padding: 0 0 8px 0;border-bottom: 1px dashed #ccc;width:70%;height:auto;word-wrap: break-word; word-break: normal;}
	</style>
  </head>
  <body>
	<div class="top_line"></div>
	<div id="comment_thread"  style="width:860px;margin:0 auto;">
		<div style="width:100%;">
			<textarea id="mainTextArea" style="width:100%;height:100px;">
			</textarea>
			<br>
			<button type="button" style="margin-left:780px" onclick="mainComments()" class="btn btn-primary">发表评论</button>
		</div>
		<div id="comment_mainDiv">
		</div>
	</div>
  </body>
</html>
<script>

Date.prototype.format = function(fmt){  
  var o = {   
    "M+" : this.getMonth()+1,                 //月份   
    "d+" : this.getDate(),                    //日   
    "h+" : this.getHours(),                   //小时   
    "m+" : this.getMinutes(),                 //分   
    "s+" : this.getSeconds(),                 //秒   
    "q+" : Math.floor((this.getMonth()+3)/3), //季度   
    "S"  : this.getMilliseconds()             //毫秒   
  };   
  if(/(y+)/.test(fmt))   
    fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));   
  for(var k in o)   
    if(new RegExp("("+ k +")").test(fmt))   
  fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));   
  return fmt;   
}

var num=1;
var userinfo=new Object();
$(function(){
	userinfo.currentUserName="潘宏博";
	userinfo.currentUserId="panhb";
})

function mainComments(){
	var cd=new Date().format("yyyy-MM-dd hh:mm");
	var textarea=$("#mainTextArea").val();
	if(textarea===null||textarea===''){
		alert("写点什么东西再发表吧");
		return;
	}
	textarea=textarea.replace(/\r\n/g,'<br>');
	textarea=textarea.replace(/\n/g,'<br>');
	var cid="comment_"+num;
	num++;
	var div="<div class='line'></div>"+
		"<div class='div_common' style='margin-left:50px;display:none;' id='"+cid+"'>"+
		"<span style='color:#c689be;'>"+userinfo.currentUserName+"</span>&nbsp;&nbsp;&nbsp;&nbsp;"+cd+"&nbsp;&nbsp;&nbsp;&nbsp;<a href=javascript:showTextArea('"+cid+"','"+userinfo.currentUserId+"','"+userinfo.currentUserName+"')><span style='font-size:10px'>回复</span></a>&nbsp;&nbsp;<a href=javascript:closeComment('"+cid+"')><span style='font-size:10px'>收起</span></a><a href=javascript:openComment('"+cid+"') style='display:none;'><span style='font-size:10px'>展开</span></a>"+
		"<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style='font-size:14px;'>"+textarea+
		"</span></div>";
	$("#comment_mainDiv").after(div);
	$("#"+cid).fadeIn("slow");
	$("#mainTextArea").val("");
}
 
function comments(id,touserid,tousername){
	var cd=new Date().format("yyyy-MM-dd hh:mm");
	var textarea=$("#textarea").val();
	if(textarea===null||textarea===''){
		alert("写点什么东西再发表吧");
		return;
	}
	textarea=textarea.replace(/\r\n/g,'<br>');
	textarea=textarea.replace(/\n/g,'<br>');
	var cid="comment_"+num;
	num++;
	var div="<br>"+
		"<div class='div_common' style='margin-left:150px;display:none;' id='"+cid+"'>"+
		"<span style='color:#c689be;'>"+userinfo.currentUserName+"</span>&nbsp;&nbsp;回复&nbsp;&nbsp;<span style='color:#c689be;'>"+tousername+"</span>&nbsp;&nbsp;&nbsp;&nbsp;"+cd+"&nbsp;&nbsp;&nbsp;&nbsp;<a href=javascript:showTextArea('"+cid+"','"+userinfo.currentUserId+"','"+userinfo.currentUserName+"')><span style='font-size:10px'>回复</span></a>"+
		"<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style='font-size:14px;'>"+textarea+
		"</span></div>";
	removeTextArea();
	$("#"+id).after(div);	
	$("#"+cid).fadeIn("slow");
}

function showTextArea(id,touserid,tousername){
	var left=$("#"+id).css("margin-left");
	if($("#div_textarea")!=null){
		removeTextArea();
	}
	var textarea="<br><div id='div_textarea' style='margin-left:"+(parseInt(left))+"px;width:300px;display:none'><textarea id='textarea' style='width:100%;height:50px;'></textarea><br>";
	textarea+="<button type='button' onclick=comments('"+id+"','"+touserid+"','"+tousername+"') class='btn btn-primary btn-xs'>评论</button><button type='button' onclick='removeTextArea()' class='btn btn-default btn-xs'>收起</button></div>";
	$("#"+id).after(textarea);
	$("#div_textarea").fadeIn("slow");
}

function removeTextArea(){
	$("#div_textarea").prev().remove();
	$("#div_textarea").remove();
}

function closeComment(id){
	$("#"+id).find("a").each(function(){
		if($(this).text()==="收起"){
			$(this).hide();
		}
		if($(this).text()==="展开"){
			$(this).show();
		}
	})
	hideComment(id);
}

function openComment(id){
	$("#"+id).find("a").each(function(){
		if($(this).text()==="收起"){
			$(this).show();
		}
		if($(this).text()==="展开"){
			$(this).hide();
		}
	})
	showComment(id);
}

function hideComment(id){
	if($("#"+id).next().next()!=null){
		var obj=$("#"+id).next().next();
		var next_left=obj.css("margin-left");
		var next_id=obj.attr("id");
		if(obj.attr("class")==='line'){
			return;
		}
		if(obj.attr("id")==='div_textarea'){
			hideComment(next_id,next_left);
		}
		if(parseInt(next_left)===150){
			obj.prev().fadeOut("slow");	
			obj.fadeOut("slow");	
			hideComment(next_id,next_left);
		}
	}
}

function showComment(id){
	if($("#"+id).next().next()!=null){
		var obj=$("#"+id).next().next();
		var next_left=obj.css("margin-left");
		var next_id=obj.attr("id");
		if(obj.attr("class")==='line'){
			return;
		}
		if(obj.attr("id")==='div_textarea'){
			showComment(next_id,next_left);
		}
		if(parseInt(next_left)===150){
			obj.prev().fadeIn("slow");
			obj.fadeIn("slow");	
			showComment(next_id,next_left);
		}
	}
}
</script>
